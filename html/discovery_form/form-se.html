<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pre-Discovery-formulär · Vikstrand Deep Solutions</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#0f172a;
      --text:#e6edf3;
      --muted:#9fb0c3;
      --accent:#60a5fa;
      --accent-strong:#3b82f6;
      --danger:#f43f5e;
      --ok:#22c55e;
      --border:#1f2937;
      --chip:#111827;
      --chip-border:#1f2937;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 10% 0%, rgba(59,130,246,.15), transparent 60%),
                  radial-gradient(1000px 800px at 90% 10%, rgba(99,102,241,.12), transparent 60%),
                  var(--bg);
      color:var(--text);
      letter-spacing: .2px;
    }
    .wrap{ max-width: 880px; margin: 48px auto; padding: 0 16px; }
    header{ display:flex; align-items:center; gap:14px; margin-bottom:20px; }
    .logo{ inline-size:42px; block-size:42px; border-radius:12px; background:linear-gradient(135deg,#67e8f9,#60a5fa); box-shadow:0 6px 20px rgba(96,165,250,.35) inset, 0 10px 30px rgba(96,165,250,.25); }
    h1{ font-size: clamp(22px, 3.2vw, 30px); margin:0; letter-spacing:.3px }
    .subtitle{ color:var(--muted); margin:6px 0 18px; }

    form{ background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid var(--border);
          border-radius:18px; padding:20px 16px; box-shadow: 0 10px 40px rgba(0,0,0,.25);
          backdrop-filter: blur(6px);
    }
    .note{ background: rgba(96,165,250,.10); color:#dbeafe; padding:10px 12px; border:1px solid rgba(96,165,250,.25); border-radius:12px; margin: 0 0 16px; font-size:14px }

    fieldset{ border:1px solid var(--border); border-radius:14px; padding:14px; margin: 14px 0; }
    legend{ padding:0 8px; color: #cbd5e1; font-weight:600; }
    label{ display:block; font-weight:600; margin-bottom:8px; }
    .req{ color:#ffd166; margin-left:6px }
    .help{ color: var(--muted); font-size: 13px; margin: 6px 0 0; }

    .group{ margin: 14px 0 6px; }
    .row{ display:flex; flex-wrap:wrap; gap: 10px 14px; }
    .chip{ display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px; border:1px solid var(--chip-border); background:var(--chip); cursor:pointer; }
    .chip input{ transform:translateY(1px); }

    input[type="email"], input[type="text"], textarea, select{
      width:100%; background:#0b1220; color:var(--text); border:1px solid var(--border); border-radius:12px; padding:12px 12px; font-size:15px;
      outline:none; transition:border .15s ease, box-shadow .15s ease;
    }
    input[type="email"]:focus, input[type="text"]:focus, textarea:focus, select:focus{ border-color: var(--accent); box-shadow:0 0 0 3px rgba(96,165,250,.25) }
    textarea{ min-height:110px; resize:vertical }

    .inline-other{ margin-top:10px }
    .hidden{ display:none !important }

    .error{ color: #fecaca; background: #7f1d1d; border:1px solid #b91c1c; padding:10px 12px; border-radius:12px; font-size:14px; margin: 10px 0 }
    .success{ color:#dcfce7; background:#065f46; border:1px solid #10b981; padding:14px; border-radius:12px; font-size:15px; margin:14px 0 }

    button[type="submit"]{
      appearance:none; border:0; background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color:white; font-weight:700; padding:14px 18px; border-radius:14px; cursor:pointer; font-size:16px; letter-spacing:.3px;
      box-shadow: 0 10px 30px rgba(59,130,246,.35);
    }
    button[type="submit"]:hover{ filter: brightness(1.05) }
    .footer{ color:var(--muted); font-size:12px; margin-top:10px }
    .grid-2{ display:grid; grid-template-columns: 1fr; gap:12px }
    @media (min-width: 720px){ .grid-2{ grid-template-columns: 1fr 1fr } }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Pre-Discovery-formulär</h1>
        <p class="subtitle">Grova uppskattningar räcker – detta hjälper oss bara att planera piloten.</p>
      </div>
    </header>

    <form id="preDiscoveryForm" novalidate>
      <p class="note">Vi använder denna information enbart för att avgränsa ert kostnadsfria Discovery-projekt. Vid behov börjar vi med ett sekretessavtal (NDA).</p>

      <div class="group">
        <label for="email">E-post <span class="req" aria-hidden="true">* Obligatoriskt</span></label>
        <input id="email" name="email" type="email" inputmode="email" autocomplete="email" required aria-describedby="emailHelp" />
        <div id="emailHelp" class="help">Vi skickar sammanfattning och nästa steg hit.</div>
      </div>

      <div class="grid-2">
        <fieldset>
          <legend>Välj ert huvudmål <span class="req" aria-hidden="true">* Obligatoriskt</span></legend>
          <div class="row" role="group" aria-labelledby="pg-help" id="pg-group">
            <label class="chip"><input type="radio" name="primary_goal" value="Cost/Efficiency" required> Kostnad/Effektivitet</label>
            <label class="chip"><input type="radio" name="primary_goal" value="Workflow Automation"> Automatisering av arbetsflöden</label>
            <label class="chip"><input type="radio" name="primary_goal" value="Search/Retrieval (RAG)"> Sökning/Återhämtning (RAG)</label>
            <label class="chip"><input type="radio" name="primary_goal" value="Vision/Images"> Bild/Video (Vision)</label>
            <label class="chip"><input type="radio" name="primary_goal" value="Forecasting/Analytics"> Prognoser/Analys</label>
            <label class="chip"><input type="radio" name="primary_goal" value="Quality/Inspection"> Kvalitet/Inspektion</label>
            <label class="chip"><input type="radio" id="goal_other" name="primary_goal" value="Other"> Annat</label>
          </div>
          <div id="pg-help" class="help">Välj det som är viktigast för er just nu.</div>
          <div id="goal_other_wrap" class="inline-other hidden">
            <label for="primary_goal_other" class="help" style="font-weight:600">Om “Annat”, ange vilket</label>
            <input type="text" id="primary_goal_other" name="primary_goal_other" placeholder="Beskriv ert mål" />
          </div>
          <div id="pg-error" class="error hidden" role="alert">Välj ett huvudmål.</div>
        </fieldset>

        <div>
          <label for="outcome">Vilket är det viktigaste önskade utfallet (det som skulle göra projektet till en framgång)?</label>
          <textarea id="outcome" name="outcome" placeholder="T.ex. ”Minska offerttid med 50 %” eller ”Auto-klassa inkommande e-post”"></textarea>
        </div>
      </div>

      <fieldset>
        <legend>Ange tillgängliga datakällor <span class="req" aria-hidden="true">* Obligatoriskt</span></legend>
        <p id="ds-help" class="help">Välj de datakällor ni har som vi kan använda under Discovery-projektet för att bygga er anpassade AI-modell.</p>
        <div class="row" role="group" aria-describedby="ds-help">
          <label class="chip"><input type="checkbox" name="data_sources" value="Sample files"> Exempelfiler</label>
          <label class="chip"><input type="checkbox" name="data_sources" value="API/Database"> API/Databas</label>
          <label class="chip"><input type="checkbox" name="data_sources" value="Cloud folders (Drive/SharePoint)"> Molnmappar (Drive/SharePoint)</label>
          <label class="chip"><input type="checkbox" name="data_sources" value="Text/Docs"> Text/Dokument</label>
          <label class="chip"><input type="checkbox" name="data_sources" value="Images/Video"> Bilder/Video</label>
          <label class="chip"><input type="checkbox" id="ds_none" name="data_sources" value="None yet"> Inget ännu</label>
          <label class="chip"><input type="checkbox" id="ds_other" name="data_sources" value="Other"> Annat</label>
        </div>
        <div id="ds_other_wrap" class="inline-other hidden">
          <label for="data_sources_other" class="help" style="font-weight:600">Om “Annat”, ange vilket</label>
          <input type="text" id="data_sources_other" name="data_sources_other" placeholder="Beskriv källan (t.ex. ERP, CRM-export)" />
        </div>
        <div id="ds-error" class="error hidden" role="alert">Välj minst en datakälla (eller ”Inget ännu”).</div>
      </fieldset>

      <div class="grid-2">
        <fieldset>
          <legend>Välj din roll i projektet <span class="req" aria-hidden="true">* Obligatoriskt</span></legend>
          <div class="row" id="role-group">
            <label class="chip"><input type="radio" name="role" value="Owner" required> Ägare</label>
            <label class="chip"><input type="radio" name="role" value="Manager"> Chef</label>
            <label class="chip"><input type="radio" name="role" value="Developer"> Utvecklare</label>
            <label class="chip"><input type="radio" id="role_other" name="role" value="Other"> Annat</label>
          </div>
          <div id="role_other_wrap" class="inline-other hidden">
            <label for="role_other_text" class="help" style="font-weight:600">Om “Annat”, ange vilket</label>
            <input type="text" id="role_other_text" name="role_other_text" placeholder="Din roll" />
          </div>
          <div id="role-error" class="error hidden" role="alert">Välj din roll.</div>
        </fieldset>

        <fieldset>
          <legend>Förväntad tillgänglig tid (per vecka) <span class="req" aria-hidden="true">* Obligatoriskt</span></legend>
          <div class="row" id="time-group">
            <label class="chip"><input type="radio" name="time" value="< 0.5 h/week" required> &lt; 0,5 h/vecka</label>
            <label class="chip"><input type="radio" name="time" value="0.5–1.0 h/week"> 0,5–1,0 h/vecka</label>
            <label class="chip"><input type="radio" name="time" value="> 1 h/week"> &gt; 1 h/vecka</label>
            <label class="chip"><input type="radio" id="time_other" name="time" value="Other"> Annat</label>
          </div>
          <div id="time_other_wrap" class="inline-other hidden">
            <label for="time_other_text" class="help" style="font-weight:600">Om “Annat”, ange hur</label>
            <input type="text" id="time_other_text" name="time_other_text" placeholder="t.ex. 2–3 h varannan vecka" />
          </div>
          <div id="time-error" class="error hidden" role="alert">Välj din förväntade tillgänglighet.</div>
        </fieldset>
      </div>

      <div class="group" style="margin-top:18px">
        <button type="submit">Skicka</button>
        <div class="footer">Genom att skicka godkänner du att vi kontaktar dig om denna pilot. Vi delar aldrig din information.</div>
      </div>

      <div id="success" class="success hidden" role="status">Tack! Dina svar sparades lokalt. Du kan kopiera dem nedan eller koppla formuläret till ditt backend/Zoho Forms.</div>
      <textarea id="result" class="hidden" readonly></textarea>
      <input type="text" name="company_website" style="display:none" tabindex="-1" autocomplete="off">
    </form>
  </div>

  <script>
  (function(){
    // Klistra in din Zoho Flow-webhook här:
    //const FLOW_URL = 'https://flow.zoho.eu/xxxxxxxxx';
    const FLOW_URL = 'https://flow.zoho.eu/20108725821/flow/webhook/incoming?zapikey=1001.2bce9560bcf7a8d4e900d2b155cd70d0.8d2c42c038f2025c7eefa55967142a5b&isdebug=true';

    const $  = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    const goalOtherRadio = $('#goal_other');
    const goalOtherWrap  = $('#goal_other_wrap');
    const roleOtherRadio = $('#role_other');
    const roleOtherWrap  = $('#role_other_wrap');
    const timeOtherRadio = $('#time_other');
    const timeOtherWrap  = $('#time_other_wrap');
    const dsNone         = $('#ds_none');
    const dsOther        = $('#ds_other');
    const dsOtherWrap    = $('#ds_other_wrap');

    function toggle(el, show){ el.classList.toggle('hidden', !show); }
    function updateGoalOther(){ toggle(goalOtherWrap, goalOtherRadio?.checked); }
    function updateRoleOther(){ toggle(roleOtherWrap, roleOtherRadio?.checked); }
    function updateTimeOther(){ toggle(timeOtherWrap, timeOtherRadio?.checked); }
    function updateDsOther(){ toggle(dsOtherWrap, dsOther?.checked); }

    function updateDsNoneExclusivity(){
      const all = $$('input[name="data_sources"]');
      if (!dsNone) return;
      if (dsNone.checked){
        all.forEach(cb => { if (cb !== dsNone) { cb.checked = false; cb.disabled = true; }});
      } else {
        all.forEach(cb => { if (cb !== dsNone) { cb.disabled = false; }});
      }
    }

    $$('#pg-group input[type="radio"]').forEach(r=> r.addEventListener('change', updateGoalOther));
    $$('#role-group input[type="radio"]').forEach(r=> r.addEventListener('change', updateRoleOther));
    $$('#time-group input[type="radio"]').forEach(r=> r.addEventListener('change', updateTimeOther));
    if (dsOther) dsOther.addEventListener('change', updateDsOther);
    if (dsNone) dsNone.addEventListener('change', updateDsNoneExclusivity);

    updateGoalOther(); updateRoleOther(); updateTimeOther(); updateDsOther(); updateDsNoneExclusivity();

    const form = $('#preDiscoveryForm');

    // --- POST till Zoho Flow med CORS-fallback ---
    async function postToFlow(json){
      const params = new URLSearchParams();
      for (const [k, v] of Object.entries(json)) {
        if (Array.isArray(v)) v.forEach(x => params.append(k + '[]', x));
        else params.append(k, v ?? '');
      }
      try {
        await fetch(FLOW_URL, {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded'},
          body: params.toString(),
          mode: 'no-cors'
        });
        return true;
      } catch (e) {
        console.error(e);
        return false;
      }
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      ['pg','ds','role','time'].forEach(id => $('#'+id+'-error')?.classList.add('hidden'));

      const emailValid = $('#email').checkValidity();
      const goalValid  = $$('#pg-group input[type="radio"]').some(r=> r.checked);
      const roleValid  = $$('#role-group input[type="radio"]').some(r=> r.checked);
      const timeValid  = $$('#time-group input[type="radio"]').some(r=> r.checked);
      const dsValid    = $$('input[name="data_sources"]').some(cb => cb.checked);

      let ok = emailValid && goalValid && roleValid && timeValid && dsValid;
      if (!goalValid) $('#pg-error')?.classList.remove('hidden');
      if (!dsValid)   $('#ds-error')?.classList.remove('hidden');
      if (!roleValid) $('#role-error')?.classList.remove('hidden');
      if (!timeValid) $('#time-error')?.classList.remove('hidden');
      if (!emailValid) $('#email').reportValidity();
      if (!ok) return;

      const val = (sel) => ( $(sel)?.value || '' );
      const checkedVal  = (sel) => { const el = $$(sel).find(x=>x.checked); return el? el.value : ''; };
      const checkedVals = (sel) => $$(sel).filter(x=>x.checked).map(x=>x.value);

      // Honeypot (om ifyllt = bot)
      const honeypot = document.querySelector('input[name="company_website"]');
      if (honeypot && honeypot.value) return;

      const payload = {
        email: val('#email'),
        primary_goal: checkedVal('#pg-group input[type="radio"]'),
        primary_goal_other: val('#primary_goal_other'),
        outcome: val('#outcome'),
        data_sources: checkedVals('input[name="data_sources"]'),
        data_sources_other: val('#data_sources_other'),
        role: checkedVal('#role-group input[type="radio"]'),
        role_other: val('#role_other_text'),
        time: checkedVal('#time-group input[type="radio"]'),
        time_other: val('#time_other_text'),
        submitted_at: new Date().toISOString()
      };
      payload.company_website =
        document.querySelector('input[name="company_website"]')?.value || '';

      // Normalisering
      payload.email = (payload.email || '').trim().toLowerCase();

      // Primary goal: om “Other”, använd fritext
      payload.goal_final =
        payload.primary_goal !== 'Other'
          ? payload.primary_goal
          : (payload.primary_goal_other || 'Other');

      // Roll/Tid med “Other”
      payload.role_final =
        payload.role !== 'Other' ? payload.role : (payload.role_other || 'Other');

      payload.time_final =
        payload.time !== 'Other' ? payload.time : (payload.time_other || 'Other');

      // Datakällor CSV (ersätt “Other” med fritext om finns)
      const ds = Array.isArray(payload.data_sources) ? payload.data_sources.filter(Boolean) : [];
      if (ds.includes('Other') && payload.data_sources_other) {
        ds.splice(ds.indexOf('Other'), 1);
        ds.push(payload.data_sources_other);
      }
      payload.data_sources_csv = ds.join(', ');

      const delivered = await postToFlow(payload);

      if (delivered) {
        // Enkel tack-sida i samma mapp
        window.location.href = 'thanks.html';
        return;
      }

      // Fallback lokalt
      $('#success')?.classList.remove('hidden');
      const out = $('#result');
      if (out) {
        out.classList.remove('hidden');
        out.value = JSON.stringify(payload, null, 2);
      }
      alert('Skickat lokalt. Vi kunde inte nå webhooken — kontrollera URL/CORS.');
    });
  })();
  </script>
</body>
</html>
